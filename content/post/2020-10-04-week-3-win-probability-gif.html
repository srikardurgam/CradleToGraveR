---
title: Week 3 Win Probability gif
author: Srikar Durgam
date: '2020-10-04'
slug: week-3-win-probability-gif
categories: []
tags:
  - Football
---



<pre class="r"><code>library(tidyverse)     # for data cleaning and plotting</code></pre>
<pre><code>## Warning: replacing previous import &#39;vctrs::data_frame&#39; by &#39;tibble::data_frame&#39;
## when loading &#39;dplyr&#39;</code></pre>
<pre><code>## -- Attaching packages ---------------------------------------------------------------------------- tidyverse 1.3.0 --</code></pre>
<pre><code>## v ggplot2 3.3.2     v purrr   0.3.4
## v tibble  3.0.3     v dplyr   1.0.0
## v tidyr   1.1.0     v stringr 1.4.0
## v readr   1.3.1     v forcats 0.5.0</code></pre>
<pre><code>## -- Conflicts ------------------------------------------------------------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(googlesheets4) # for reading googlesheet data
library(lubridate)     # for date manipulation</code></pre>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     date, intersect, setdiff, union</code></pre>
<pre class="r"><code>library(openintro)     # for the abbr2state() function</code></pre>
<pre><code>## Loading required package: airports</code></pre>
<pre><code>## Loading required package: cherryblossom</code></pre>
<pre><code>## Loading required package: usdata</code></pre>
<pre class="r"><code>library(palmerpenguins)# for Palmer penguin data
library(maps)          # for map data</code></pre>
<pre><code>## 
## Attaching package: &#39;maps&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     map</code></pre>
<pre class="r"><code>library(ggmap)         # for mapping points on maps</code></pre>
<pre><code>## Google&#39;s Terms of Service: https://cloud.google.com/maps-platform/terms/.</code></pre>
<pre><code>## Please cite ggmap if you use it! See citation(&quot;ggmap&quot;) for details.</code></pre>
<pre class="r"><code>library(gplots)        # for col2hex() function</code></pre>
<pre><code>## 
## Attaching package: &#39;gplots&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     lowess</code></pre>
<pre class="r"><code>library(RColorBrewer)  # for color palettes
library(sf)            # for working with spatial data</code></pre>
<pre><code>## Linking to GEOS 3.8.0, GDAL 3.0.4, PROJ 6.3.1</code></pre>
<pre class="r"><code>library(leaflet)       # for highly customizable mapping
library(ggthemes)      # for more themes (including theme_map())
library(plotly)        # for the ggplotly() - basic interactivity</code></pre>
<pre><code>## 
## Attaching package: &#39;plotly&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ggmap&#39;:
## 
##     wind</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     last_plot</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     filter</code></pre>
<pre><code>## The following object is masked from &#39;package:graphics&#39;:
## 
##     layout</code></pre>
<pre class="r"><code>library(gganimate)     # for adding animation layers to ggplots
library(gifski)        # for creating the gif (don&#39;t need to load this library every time,but need it installed)
library(transformr)    # for &quot;tweening&quot; (gganimate)</code></pre>
<pre><code>## 
## Attaching package: &#39;transformr&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:sf&#39;:
## 
##     st_normalize</code></pre>
<pre class="r"><code>library(shiny)         # for creating interactive apps
gs4_deauth()           # To not have to authorize each time you knit.
library(teamcolors)
library(blogdown)
if (!requireNamespace(&quot;remotes&quot;, quietly = TRUE)) {install.packages(&quot;remotes&quot;)}
remotes::install_github(&quot;mrcaseb/nflfastR&quot;)</code></pre>
<pre><code>## Skipping install of &#39;nflfastR&#39; from a github remote, the SHA1 (178cfefb) has not changed since last install.
##   Use `force = TRUE` to force installation</code></pre>
<pre class="r"><code>options(scipen = 9999)
theme_set(theme_minimal())</code></pre>
<pre class="r"><code>data &lt;- readRDS(url(&#39;https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2020.rds&#39;))</code></pre>
<pre class="r"><code>Week3ATL &lt;- data %&gt;% 
            filter(week == 3) %&gt;%
            filter(home_team == &#39;ATL&#39;)</code></pre>
<pre class="r"><code>nfl_teamcolors &lt;- teamcolors %&gt;% filter(league == &quot;nfl&quot;)
atl_color &lt;- nfl_teamcolors %&gt;%
  filter(name == &quot;Atlanta Falcons&quot;) %&gt;%
  pull(primary)
chi_color &lt;- nfl_teamcolors %&gt;%
  filter(name == &quot;Chicago Bears&quot;) %&gt;%
  pull(primary)</code></pre>
<pre class="r"><code>Week3ATL %&gt;% filter(!is.na(home_wp),
         !is.na(away_wp)) %&gt;%
  dplyr::select(game_seconds_remaining,
                home_wp,
                away_wp) %&gt;%
  gather(team, wpa, -game_seconds_remaining) %&gt;%
  ggplot(aes(x = game_seconds_remaining, y = wpa, color = team)) +
  geom_line(size = 2) +
  geom_hline(yintercept = 0.5, color = &quot;gray&quot;, linetype = &quot;dashed&quot;) +
  scale_color_manual(labels = c(&quot;CHI&quot;, &quot;ATL&quot;),
                     values = c(chi_color, atl_color),
                     guide = FALSE) +
  scale_x_reverse(breaks = seq(0, 3600, 300)) + 
  annotate(&quot;text&quot;, x = 3000, y = .75, label = &quot;ATL&quot;, color = atl_color, size = 8) + 
  annotate(&quot;text&quot;, x = 3000, y = .25, label = &quot;CHI&quot;, color = chi_color, size = 8) +
  geom_vline(xintercept = 900, linetype = &quot;dashed&quot;) + 
  geom_vline(xintercept = 1800, linetype = &quot;dashed&quot;) + 
  geom_vline(xintercept = 2700, linetype = &quot;dashed&quot;) + 
  geom_vline(xintercept = 0, linetype = &quot;dashed&quot;) + 
  labs(
    x = &quot;Time Remaining (seconds)&quot;,
    y = &quot;Win Probability&quot;,
    title = &quot;Week 3 Win Probability Chart&quot;,
    subtitle = &quot;Chicago Bears vs Atlanta Falcons&quot;,
    caption = &quot;Data from nflfastR&quot;
  ) + theme_bw() + 
  transition_reveal(-game_seconds_remaining)</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-5"></span>
<img src="/post/2020-10-04-week-3-win-probability-gif_files/figure-html/unnamed-chunk-5-1.gif" alt="Win Probability Chart."  />
<p class="caption">
Figure 1: Win Probability Chart.
</p>
</div>
<p><img src="winprob1.gif" /><!-- --></p>
