---
title: Week 3 Win
author: Srikar Durgam
date: '2020-10-02'
slug: week-3-win
categories:
  - R
  - Football
tags:
  - Football
  - NFL
---



<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## Warning: replacing previous import &#39;vctrs::data_frame&#39; by &#39;tibble::data_frame&#39;
## when loading &#39;dplyr&#39;</code></pre>
<pre><code>## -- Attaching packages ---------------------------------------------------------------------------- tidyverse 1.3.0 --</code></pre>
<pre><code>## v ggplot2 3.3.2     v purrr   0.3.4
## v tibble  3.0.3     v dplyr   1.0.0
## v tidyr   1.1.0     v stringr 1.4.0
## v readr   1.3.1     v forcats 0.5.0</code></pre>
<pre><code>## -- Conflicts ------------------------------------------------------------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(lubridate)</code></pre>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     date, intersect, setdiff, union</code></pre>
<pre class="r"><code>library(ggplot2)
library(plotly)</code></pre>
<pre><code>## 
## Attaching package: &#39;plotly&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     last_plot</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     filter</code></pre>
<pre><code>## The following object is masked from &#39;package:graphics&#39;:
## 
##     layout</code></pre>
<pre class="r"><code>library(patchwork) 
library(hrbrthemes)</code></pre>
<pre><code>## NOTE: Either Arial Narrow or Roboto Condensed fonts are required to use these themes.</code></pre>
<pre><code>##       Please use hrbrthemes::import_roboto_condensed() to install Roboto Condensed and</code></pre>
<pre><code>##       if Arial Narrow is not on your system, please see https://bit.ly/arialnarrow</code></pre>
<pre class="r"><code>library(ggrepel)
library(ggimage)
library(teamcolors)
if (!requireNamespace(&quot;remotes&quot;, quietly = TRUE)) {install.packages(&quot;remotes&quot;)}
remotes::install_github(&quot;mrcaseb/nflfastR&quot;)</code></pre>
<pre><code>## Skipping install of &#39;nflfastR&#39; from a github remote, the SHA1 (b6693a89) has not changed since last install.
##   Use `force = TRUE` to force installation</code></pre>
<pre class="r"><code>options(scipen = 9999)</code></pre>
<pre class="r"><code>data &lt;- readRDS(url(&#39;https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2020.rds&#39;))</code></pre>
<pre class="r"><code>Week3ATL &lt;- data %&gt;% 
            filter(week == 3) %&gt;%
            filter(home_team == &#39;ATL&#39;)</code></pre>
<pre class="r"><code>nfl_teamcolors &lt;- teamcolors %&gt;% filter(league == &quot;nfl&quot;)
atl_color &lt;- nfl_teamcolors %&gt;%
  filter(name == &quot;Atlanta Falcons&quot;) %&gt;%
  pull(primary)
chi_color &lt;- nfl_teamcolors %&gt;%
  filter(name == &quot;Chicago Bears&quot;) %&gt;%
  pull(primary)</code></pre>
<pre class="r"><code>Week3ATL %&gt;% filter(!is.na(home_wp),
         !is.na(away_wp)) %&gt;%
  dplyr::select(game_seconds_remaining,
                home_wp,
                away_wp) %&gt;%
  gather(team, wpa, -game_seconds_remaining) %&gt;%
  ggplot(aes(x = game_seconds_remaining, y = wpa, color = team)) +
  geom_line(size = 2) +
  geom_hline(yintercept = 0.5, color = &quot;gray&quot;, linetype = &quot;dashed&quot;) +
  scale_color_manual(labels = c(&quot;CHI&quot;, &quot;ATL&quot;),
                     values = c(chi_color, atl_color),
                     guide = FALSE) +
  scale_x_reverse(breaks = seq(0, 3600, 300)) + 
  annotate(&quot;text&quot;, x = 3000, y = .75, label = &quot;ATL&quot;, color = atl_color, size = 8) + 
  annotate(&quot;text&quot;, x = 3000, y = .25, label = &quot;CHI&quot;, color = chi_color, size = 8) +
  geom_vline(xintercept = 900, linetype = &quot;dashed&quot;) + 
  geom_vline(xintercept = 1800, linetype = &quot;dashed&quot;) + 
  geom_vline(xintercept = 2700, linetype = &quot;dashed&quot;) + 
  geom_vline(xintercept = 0, linetype = &quot;dashed&quot;) + 
  labs(
    x = &quot;Time Remaining (seconds)&quot;,
    y = &quot;Win Probability&quot;,
    title = &quot;Week 3 Win Probability Chart&quot;,
    subtitle = &quot;Chicago Bears vs Atlanta Falcons&quot;,
    caption = &quot;Data from nflfastR&quot;
  ) + theme_bw()</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-5"></span>
<img src="/post/2020-10-02-week-3-win_files/figure-html/unnamed-chunk-5-1.png" alt="A fancy pie chart." width="672" />
<p class="caption">
Figure 1: A fancy pie chart.
</p>
</div>
